var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function a(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function c(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function f(){return t=" ",document.createTextNode(t);var t}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}let p;function d(t){p=t}function g(t){(function(){if(!p)throw new Error("Function called outside component initialization");return p})().$$.on_mount.push(t)}const _=[],m=[],v=[],w=[],y=Promise.resolve();let b=!1;function x(t){v.push(t)}let E=!1;const $=new Set;function L(){if(!E){E=!0;do{for(let t=0;t<_.length;t+=1){const e=_[t];d(e),A(e.$$)}for(d(null),_.length=0;m.length;)m.pop()();for(let t=0;t<v.length;t+=1){const e=v[t];$.has(e)||($.add(e),e())}v.length=0}while(_.length);for(;w.length;)w.pop()();b=!1,E=!1,$.clear()}}function A(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(x)}}const I=new Set;function D(t,e){-1===t.$$.dirty[0]&&(_.push(t),b||(b=!0,y.then(L)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function M(i,o,s,u,c,f,h=[-1]){const g=p;d(i);const _=o.props||{},m=i.$$={fragment:null,ctx:null,props:f,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(g?g.$$.context:[]),callbacks:n(),dirty:h,skip_bound:!1};let v=!1;if(m.ctx=s?s(i,_,((t,e,...n)=>{const r=n.length?n[0]:e;return m.ctx&&c(m.ctx[t],m.ctx[t]=r)&&(!m.skip_bound&&m.bound[t]&&m.bound[t](r),v&&D(i,t)),e})):[],m.update(),v=!0,r(m.before_update),m.fragment=!!u&&u(m.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);m.fragment&&m.fragment.l(t),t.forEach(l)}else m.fragment&&m.fragment.c();o.intro&&((w=i.$$.fragment)&&w.i&&(I.delete(w),w.i(y))),function(t,n,i){const{fragment:o,on_mount:s,on_destroy:l,after_update:u}=t.$$;o&&o.m(n,i),x((()=>{const n=s.map(e).filter(a);l?l.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(x)}(i,o.target,o.anchor),L()}var w,y;d(g)}function k(t,e){this._waveformData=t,this._channelIndex=e}k.prototype.min_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._adapter.at(e)},k.prototype.max_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._adapter.at(e)},k.prototype.min_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex)},k.prototype.max_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex+1)};var T=k;function B(t){this._data=t}B.isCompatible=function(t){return t&&"object"==typeof t&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t},B.prototype={get version(){return this._data.version||1},get bits(){return this._data.bits},get channels(){return this._data.channels||1},get sample_rate(){return this._data.sample_rate},get scale(){return this._data.samples_per_pixel},get length(){return this._data.length},at:function(t){var e=this._data.data;if(t>=0&&t<e.length)return e[t];throw new RangeError("Invalid index: "+t)},concatBuffers:function(){var t=Array.prototype.slice.call(arguments),e=t.map((function(t){return t._data.data})),n=Object.assign({},this._data);return n.data=n.data.concat.apply(n.data,e),n.length+=t.reduce((function(t,e){return t+e.length}),0),n}};var O=B;function R(t){this._data=new DataView(t),this._offset=2===this.version?24:20}R.isCompatible=function(t){var e=t&&"object"==typeof t&&"byteLength"in t;if(e){var n=new DataView(t).getInt32(0,!0);if(1!==n&&2!==n)throw new TypeError("This waveform data version not supported.")}return e},R.prototype={get version(){return this._data.getInt32(0,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get channels(){return 2===this.version?this._data.getInt32(20,!0):1},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},get length(){return this._data.getUint32(16,!0)},at:function(t){return this._data.getInt8(this._offset+t)},concatBuffers:function(){var t,e,n=Array.prototype.slice.call(arguments),r=this._offset,a=r,i=0,o=[this].concat(n).map((function(t){return t._data.buffer}));for(t=0;t<o.length;t++){e=o[t];var s=new DataView(e).getInt32(16,!0);a+=e.byteLength-r,i+=s}var l=new ArrayBuffer(a),u=new DataView(o[0]),c=new DataView(l);for(t=0;t<r;t++)c.setUint8(t,u.getUint8(t));c.setInt32(16,i,!0);var f=0,h=new Uint8Array(l,r);for(t=0;t<o.length;t++)e=o[t],h.set(new Uint8Array(e,r),f),f+=e.byteLength-r;return l}};var j=[R,O];function q(t){var e=this._getAdapter(t);this._adapter=new e(t),this._channels=[];for(var n=0;n<this.channels;n++)this._channels[n]=new T(this,n)}q.create=function(t){return new q(t)},q.prototype={_getAdapter:function(t){var e=null;if(j.some((function(n){if(n.isCompatible(t))return e=n,!0})),null===e)throw new TypeError("Could not detect a WaveformData adapter from the input.");return e},resample:function(t){"number"==typeof t&&(t={width:t}),t.input_index="number"==typeof t.input_index?t.input_index:null,t.output_index="number"==typeof t.output_index?t.output_index:null,t.scale="number"==typeof t.scale?t.scale:null,t.width="number"==typeof t.width?t.width:null;var e=Boolean(t.input_index)||Boolean(t.output_index);if(null!=t.input_index&&t.input_index<0)throw new RangeError("options.input_index should be a positive integer value. ["+t.input_index+"]");if(null!=t.output_index&&t.output_index<0)throw new RangeError("options.output_index should be a positive integer value. ["+t.output_index+"]");if(null!=t.width&&t.width<=0)throw new RangeError("options.width should be a strictly positive integer value. ["+t.width+"]");if(null!=t.scale&&t.scale<=0)throw new RangeError("options.scale should be a strictly positive integer value. ["+t.scale+"]");if(!t.scale&&!t.width)throw new RangeError("You should provide either a resampling scale or a width in pixel the data should fit in.");var n=["width","scale","output_index","input_index"].reduce((function(e,n){return e+(null===t[n]?0:1)}),0);if(e&&4!==n)throw new Error("Some partial resampling options are missing. You provided "+n+" of them over 4.");var r,a=[],i=t.scale||Math.floor(this.duration*this.sample_rate/t.width),o=this.scale,s=2*this.channels,l=this.length,u=t.input_index||0,c=t.output_index||0,f=this.channels,h=new Array(f),p=new Array(f);for(r=0;r<f;++r)l>0?(h[r]=this.channel(r).min_sample(u),p[r]=this.channel(r).max_sample(u)):(h[r]=0,p[r]=0);var d,g,_,m;if(i<o)throw new Error("Zoom level "+i+" too low, minimum: "+o);function v(t){return Math.floor(t*i)}function w(t,e){a.push(t,e)}for(;u<l;){for(;Math.floor(v(c)/o)<=u;){if(c>0)for(r=0;r<f;++r)w(h[r],p[r]);if(m=u,(d=v(++c))!==v(c-1))for(r=0;r<f;++r)h[r]=127,p[r]=-128}for(d=v(c),(g=Math.floor(d/o))>l&&(g=l);u<g;){for(r=0;r<f;++r)(_=this.channel(r).min_sample(u))<h[r]&&(h[r]=_),(_=this.channel(r).max_sample(u))>p[r]&&(p[r]=_);u++}if(e&&a.length/s>=t.width)break}if(e){if(a.length/s>t.width&&u!==m)for(r=0;r<f;++r)w(h[r],p[r])}else if(u!==m)for(r=0;r<f;++r)w(h[r],p[r]);return new q({version:this._adapter.version,bits:this.bits,samples_per_pixel:i,length:a.length/s,data:a,sample_rate:this.sample_rate,channels:f})},concat:function(){var t=this,e=Array.prototype.slice.call(arguments);e.forEach((function(e){if(t.channels!==e.channels||t.sample_rate!==e.sample_rate||t.scale!==e.scale||Object.getPrototypeOf(t._adapter)!==Object.getPrototypeOf(e._adapter)||t._adapter.version!==e._adapter.version)throw new Error("Waveforms are incompatible")}));var n=e.map((function(t){return t._adapter})),r=this._adapter.concatBuffers.apply(this._adapter,n);return new q(r)},_offsetValues:function(t,e,n){var r=this._adapter,a=[],i=this.channels;n+=t*i*2;for(var o=0;o<e;o++)a.push(r.at(o*i*2+n));return a},get length(){return this._adapter.length},get bits(){return this._adapter.bits},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return this._adapter.channels},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._adapter.sample_rate},get scale(){return this._adapter.scale},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate}};var C=q,P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},U=!!(P===P.window&&P.URL&&P.Blob&&P.Worker);function V(t,e){var n,r=this;if(e=e||{},U)return n=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new P.Worker(P.URL.createObjectURL(new P.Blob([n],{type:"text/javascript"})));this.self=e,this.self.postMessage=function(t){setTimeout((function(){r.onmessage({data:t})}),0)},setTimeout(t.bind(e,e),0)}V.prototype.postMessage=function(t){var e=this;setTimeout((function(){e.self.onmessage({data:t})}),0)};var S=V;function W(t,e){var n=new S((function(){var t=127,e=-128;this.addEventListener("message",(function n(r){var a,i,o=r.data.scale,s=r.data.amplitude_scale,l=r.data.split_channels,u=r.data.audio_buffer,c=u.channels,f=l?c.length:1,h=1===f?1:2,p=1===h?20:24,d=function(t,e){var n=Math.floor(t/e);return t-n*e>0&&n++,n}(u.length,o),g=new DataView(new ArrayBuffer(p+2*d*f)),_=0,m=u.length,v=p,w=new Array(f),y=new Array(f);for(a=0;a<f;a++)w[a]=1/0,y[a]=-1/0;for(g.setInt32(0,h,!0),g.setUint32(4,1,!0),g.setInt32(8,u.sampleRate,!0),g.setInt32(12,o,!0),g.setInt32(16,d,!0),2===h&&g.setInt32(20,f,!0),i=0;i<m;i++){var b=0;if(1===f){for(a=0;a<c.length;++a)b+=c[a][i];(b=Math.floor(t*b*s/c.length))<w[0]&&(w[0]=b,w[0]<e&&(w[0]=e)),b>y[0]&&(y[0]=b,y[0]>t&&(y[0]=t))}else for(a=0;a<f;++a)(b=Math.floor(t*c[a][i]*s))<w[a]&&(w[a]=b,w[a]<e&&(w[a]=e)),b>y[a]&&(y[a]=b,y[a]>t&&(y[a]=t));if(++_===o){for(a=0;a<f;a++)g.setInt8(v++,w[a]),g.setInt8(v++,y[a]),w[a]=1/0,y[a]=-1/0;_=0}}if(_>0)for(a=0;a<f;a++)g.setInt8(v++,w[a]),g.setInt8(v++,y[a]);this.postMessage(g),this.removeEventListener("message",n),this.close()}))}));n.addEventListener("message",(function t(r){e(r.data),n.removeEventListener("message",t)})),n.postMessage(t)}var Y=function(t,e){return function(n){for(var r={length:n.length,sampleRate:n.sampleRate,channels:[]},a=0;a<n.numberOfChannels;++a)r.channels[a]=n.getChannelData(a);W({scale:t.scale,amplitude_scale:t.amplitude_scale,split_channels:t.split_channels,audio_buffer:r},(function(t){e(null,new C(t.buffer),n)}))}},N=512,z=1,H=!1;var F=function(t){if(Object.prototype.hasOwnProperty.call(t,"scale_adjuster"))throw new Error("Please rename the 'scale_adjuster' option to 'amplitude_scale'");return{scale:t.scale||N,amplitude_scale:t.amplitude_scale||z,split_channels:t.split_channels||H}};var X=function(t,e){var n=F(t);if(t.audio_context&&t.array_buffer)return function(t,e,n,r){t.decodeAudioData(e,Y(n,r),(function(t){t||(t=new DOMException("EncodingError")),r(t)}))}(t.audio_context,t.array_buffer,n,e);if(t.audio_buffer)return function(t,e,n){return Y(e,n)(t)}(t.audio_buffer,n,e);throw new TypeError("Please pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")};C.createFromAudio=X;var Z=C,G={value:()=>{}};function J(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new K(r)}function K(t){this._=t}function Q(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function tt(t,e){for(var n,r=0,a=t.length;r<a;++r)if((n=t[r]).name===e)return n.value}function et(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=G,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}K.prototype=J.prototype={constructor:K,on:function(t,e){var n,r=this._,a=Q(t+"",r),i=-1,o=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<o;)if(n=(t=a[i]).type)r[n]=et(r[n],t.name,e);else if(null==e)for(n in r)r[n]=et(r[n],t.name,null);return this}for(;++i<o;)if((n=(t=a[i]).type)&&(n=tt(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new K(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),i=0;i<n;++i)a[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,a)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};J("start","end","cancel","interrupt");function nt(t){let e,n;return{c(){e=c("svg"),n=c("path"),h(n,"d","M8,5v14l11-7L8,5z"),h(e,"class","icon svelte-yqyorr"),h(e,"viewBox","0 0 24 24")},m(t,r){s(t,e,r),o(e,n)},d(t){t&&l(e)}}}function rt(t){let e,n;return{c(){e=c("svg"),n=c("path"),h(n,"d","M6 5L6 19L10 19L10 5L6 5 z M 14 5L14 19L18 19L18 5L14 5 z"),h(e,"class","icon svelte-yqyorr"),h(e,"viewBox","0 0 24 24")},m(t,r){s(t,e,r),o(e,n)},d(t){t&&l(e)}}}function at(e){let n,r,a,i,c,p,d,g,_,m,v,w,y;function b(t,e){return t[5]?rt:nt}let x=b(e),E=x(e);return{c(){n=u("main"),r=u("div"),a=u("div"),i=u("button"),E.c(),c=f(),p=u("div"),d=u("audio"),d.innerHTML='<source src="http://localhost:5000/test.wav" type="audio/wav"/>',g=f(),_=u("canvas"),m=f(),v=u("div"),v.innerHTML='<canvas width="800" height="300" class="overlay svelte-yqyorr"></canvas>',h(i,"class","svelte-yqyorr"),h(a,"class","controls svelte-yqyorr"),h(d,"preload","auto"),h(_,"width","800"),h(_,"height","300"),h(_,"class","canvas-main svelte-yqyorr"),h(v,"class","overlay-container svelte-yqyorr"),h(p,"class","waves svelte-yqyorr"),h(r,"class","player svelte-yqyorr"),h(n,"class","svelte-yqyorr")},m(t,l){s(t,n,l),o(n,r),o(r,a),o(a,i),E.m(i,null),o(r,c),o(r,p),o(p,d),e[9](d),o(p,g),o(p,_),e[10](_),o(p,m),o(p,v),e[11](v),e[12](p),e[13](r),w||(y=function(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}(i,"click",e[6]),w=!0)},p(t,[e]){x!==(x=b(t))&&(E.d(1),E=x(t),E&&(E.c(),E.m(i,null)))},i:t,o:t,d(t){t&&l(n),E.d(),e[9](null),e[10](null),e[11](null),e[12](null),e[13](null),w=!1,y()}}}function it(t){}function ot(t,e){return e-(t+128)*e/256}function st(t,e,n){let r,a,i,o,s,{name:l}=e,{offsetY:u=100}=e;const c=new AudioContext;g((()=>{fetch("http://localhost:5000/test.wav").then((t=>t.arrayBuffer())).then((t=>{const e={audio_context:c,array_buffer:t,scale:128};return new Promise(((t,n)=>{Z.createFromAudio(e,((e,r)=>{e?n(e):t(r)}))}))})).then($).then((()=>{n(4,s.style.transform="translateX(0) scaleY(1)",s)}))}));let f,h=!1,p=!1,d=0,_=!0;function v(){console.log("is ready!"),p=!0,_&&(E(),_=!1)}function w(t){console.log("stop"),n(5,h=!1),n(3,o.style.transitionDuration="0",o)}function y(t){console.log("start"),n(5,h=!0),n(3,o.style.width="0",o),n(3,o.style.transitionDuration="0.6s",o)}function b(t){const e=h?.6:0,r=100*((t.currentTarget.currentTime+e)/d);n(3,o.style.width=`${isNaN(r)?0:r}%`,o),n(3,o.style.transitionDuration=`${e}s`,o)}function x(t){d=t.currentTarget.duration,console.log(d)}function E(){if(console.log(p,h),h||p)return p&&h?(i.pause(),void n(2,i.currentTime=0,i)):void i.play();i.load(),n(2,i.volume=1,i),n(2,i.loop=!0,i),i.addEventListener("canplay",v),i.addEventListener("playing",y),i.addEventListener("play",y),i.addEventListener("pause",w),i.addEventListener("playing",it),i.addEventListener("timeupdate",b),i.addEventListener("durationchange",x)}function $(t){f=t,n(0,r.width=r.clientWidth,r),n(0,r.height=r.clientHeight,r);let e=r.getContext("2d");e.clearRect(0,0,r.width,r.height),L(e,f.length,"black");const a=o.querySelector("canvas");a.width=r.clientWidth,a.height=r.clientHeight,e=a.getContext("2d"),L(e,f.length,"green")}function L(t,e,n){const a=f.channel(0),i=r.width/f.length,o=Math.min(e,f.length-1);t.clearRect(0,0,i*o,r.height),t.beginPath(),t.fillStyle=n,t.strokeStyle=n;for(let n=0;n<Math.min(e,f.length);n++){const e=a.max_sample(n);t.lineTo(n*i,ot(e,r.height)+i)}for(let e=o;e>=0;e--){const n=a.min_sample(e);t.lineTo(e*i,ot(n,r.height)+i)}t.closePath(),t.stroke(),t.fill()}return t.$$set=t=>{"name"in t&&n(7,l=t.name),"offsetY"in t&&n(8,u=t.offsetY)},[r,a,i,o,s,h,E,l,u,function(t){m[t?"unshift":"push"]((()=>{i=t,n(2,i)}))},function(t){m[t?"unshift":"push"]((()=>{r=t,n(0,r)}))},function(t){m[t?"unshift":"push"]((()=>{o=t,n(3,o)}))},function(t){m[t?"unshift":"push"]((()=>{s=t,n(4,s)}))},function(t){m[t?"unshift":"push"]((()=>{a=t,n(1,a)}))}]}return new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),M(this,t,st,at,i,{name:7,offsetY:8})}}({target:document.getElementById("root"),props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
